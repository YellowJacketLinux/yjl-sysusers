.TH "YJL\-SYSUSERS" "8" "May 2023" "yjl\-sysusers 0.1.0" "System Management Commands"
.SH "NAME"
yjl\-sysusers \- Add system users and groups
.SH SYNOPSIS
.HP \w'\fByjl-sysusers\fR\ 'u
\fByjl-sysusers\fR [\fIOPTIONS\fR] \fIACCOUNT\fR
.\" --- continue later
.SH DESCRIPTION
.PP
\fByjl\-sysusers\fR is a wrapper script to the operating system
\fBgroupadd\fR and \fBuseradd\fR commands that allows respecting
the operating system static UID and GID assignment when available,
without the need to assign them manually\&.
.PP
Static UID and GID values, as well as some other parameters useful to
the \fBuseradd\fR command, are defined in the file
\fByjl\-sysusers.json\fR which is normally located in the directory
/var/lib/yjl\-sysusers\&.
.PP
\fByjl\-sysusers\fR was developed with RPM package scriptlets in
mind\&.
.\" --- continue later
.SH OPTIONS
.PP
Options can be used when \fIACCOUNT\fR has not been described
in the \fByjl\-sysusers.json\fR file or to override default
settings for \fIACCOUNT\fR as defined in the \fByjl\-sysusers.json\fR
file\&.
.PP
\fB\-h\fR, \fB\-\-help\fR
.RS 4
Display help message and exit\&.
.RE
.PP
\fB\-c\fR, \fB\-\-comment\fR \&\fICOMMENT\fR
.RS 4
Define the comment field to be used in the /etc/passwd file\&.
This is used to provide a brief description of \fIACCOUNT\fR\&.
\fICOMMENT\fR must be printable ASCII, excluding the \\ and :
characters\&.
\fICOMMENT\fR must not exceed 60 characters\&.
.RE
.PP
\fB\-d\fR, \fB\-\-home\fR \fIHOME\fR
.RS 4
Define the home directory to be used with the system user account\&.
It must be full path and can only use lower\-case alpha\-numeric
characters plus underscore, forward\-slash, and hyphen\&.
.RE
.PP
\fB\-s\fR, \fB\-\-shell\fR \fISHELL\fR
.RS 4
Define the login shell to be used with the system user account\&.
If \fISHELL\fR is not present in /etc/shells or is not installed on
the system, then /sbin/nologin or /bin/false will be substituted\&.
.sp
\fByjl\-sysuers\fR will use /sbin/nologin for any \fIACCOUNT\fR
that does have a valid \fISHELL\fR specified unless /sbin/nologin
is not present on the system\&. In such cases, /bin/false is
used instead\&.
.RE
.PP
\fB\-\-useradd\fR \fI{True,False}\fR
.RS 4
Define whether or not the user name \fIACCOUNT\fR should be created\&.
.sp
When \fB\-\-useradd\fR is set to \fIFalse\fR then \fB\-\-groupadd\fR
is automatically set to \fITrue\fR\&.
.RE
.PP
\fB\-\-groupadd\fR \fI{True,False}\fR
.RS 4
Define whether or not the group name \fIACCOUNT\fR should be created\fR.
.sp
When \fB\-\-groupadd\fR is set to \fIFalse\fR then \fB\-\-useradd\fR
is automatically set to \fITrue\fR\&.
.RE
.PP
\fB\-g\fR, \fB\-\-group\fR \fIGROUP\fR
.RS 4
Define the primary group for the user \fIACCOUNT\fR with a different
group name than \fIACCOUNT\fR\&.
.sp
If the group \fIGROUP\fR does not exist, it will be created
automatically\&.
.sp
When \fIGROUP\fR is defined, the group \fIACCOUNT\fR will not be
created regardless of \fB\-\-groupadd\fR and the user \fIACCOUNT\fR
will be created regardless of \fB\-\-useradd\fR\&.
.RE
.PP
\fB\-\-mkdir\fR \fI{True,False}\fR
.RS 4
Define whether or not the home directory for user \fIACCOUNT\fR should
be created\&. The default with system accounts is not to create the
directory automatically\&.
.RE
.\" --- insert NOTES here
.SH USAGE NOTES
.PP
The boolean options (\fB\-\-useradd\fR, \fB\-\-groupadd\fR, and
\fB\-\-mkdir\fR) are case sensitive \fITrue\fR or \fIFalse\fR\&.
.sp
When \fB\-\-groupadd \fIFalse\fR is used without using
\fB\-g\fR, \fB\-\-group\fR \fIGROUP\fR then the system group
\fBnogroup\fR
will be used as the primary group for \fIACCOUNT\fR\&.
.\" ---
.SH PACKAGER NOTES
.PP
When creating an RPM (or other) package that has files owned by
non-root users and groups, you should use \fByjl\-sysusers\fR in
the package \fI%pre\fR scriptlet to ensure the appropriate
users and groups exist at the time the files are installed\&.
.sp
RPM packagers should use the macro \fB%{_yjl_sysusers}\fR rather
that the command \fByjl\-sysusers\fR or
\fB/usr/sbin/yjl\-sysusers\fR\&.
.sp
RPM packagers should \fBRequires(pre): %{_yjl_sysusers}\fR\&.
.sp
Packagers should avoid using
\fB\-c\fR, \fB\-\-comment\fR \fICOMMENT\fR as it can interfere
with the string being properly translated via gettext i18n
facilities into the preferred language of the system\&.
.sp
Packagers should usually avoid using
\fB\-\-mkdir\fR \fITrue\fR\&.
.sp
When \fBuseradd\fR creates the \fIHOME\fR directory, it also copies
the contents of /etc/skel into that directory\&. Usually that is not
desired\&. It is often better to have the package create the
\fBhome\fR directory when a home directory is needed\&.
.sp
Packagers should never assume the contents of the
\fByjl-sysusers.json\fR file are correct for the package, but
should specify the correct option parameters when ensuring that
\fIACCOUNT\fR exists\&.
.sp
The primary motivation for this wrapper script is to allow for
truly portable RPM spec files that can build and install on many
GNU/Linux distributions while still respecting the static GID/UID
assignments for system users and groups that a distribution (or
system administrator) wants to enforce\&.
.sp
A secondary motive for this wrapper script is to allow for the
internationalization of system user account descriptions (the
\fICOMMENT\fR of /etc/passwd) at the time of package install\&.
.sp
Lazy packaging where the packager relies upon \fByjl-sysusers.json\fR
to have correct user account parameters is not a motive for this
package, although compensating for lazy packaging was a motive for
allowing sane \fBuseradd\fR defaults to be specified in that file\&.
.PP
.\" --- end Packager Notes
.SH EXAMPLES
.PP
\f[B]yjl\-sysusers\f[] \f[I]somename\f[]
.PD 0
.P
.PD
: If \f[I]somename\f[] is defined in /var/lib/yjl\-sysusers.json then
the user and/or group will be created according to the paramaters in
that file.
If \f[I]somename\f[] is \f[B]NOT\f[] defined in that file, then both a
user and group will be created using /dev/null as the home directory and
/sbin/login (or /bin/false) as the login shell.
.PP
\f[B]yjl\-sysusers\f[] \f[B]\-g\f[] \f[I]mail\f[] \f[I]sendmail\f[]
.PD 0
.P
.PD
: If \f[I]mail\f[] is defined in /var/lib/yjl\-sysusers.json then the
group \f[I]mail\f[] will be created using the \f[I]GID\f[] defined
there, unless already in use.
Otherwise it will created with a \f[I]GID\f[] from the dynamic range for
system groups.
If the user \f[I]sendmail\f[] is defined in /var/lib/yjl\-sysuers.json
then the user \f[I]sendmail\f[] will be created using the parameters
defined there, but will be created using \f[I]mail\f[] as the primary
group regardless of the parameters in that file.
.SH EXIT STATUS
.PP
\f[B]0\f[]
.PD 0
.P
.PD
: Success
.PP
\f[B]1\f[]
.PD 0
.P
.PD
: The program failed to create requested group and/or user.
.SH BUGS
.PP
Yes, I have seen Starship Troopers.
Bugs can be very insideous and hard to get rid of, but I expect them to
be random and light.
.SH COPYRIGHT
.PP
Copyright (c) 2023 YellowJacket GNU/Linux.
License MIT <https://spdx.org/licenses/MIT.html>.
This is free software: you are free to change and redistribute it.
There is no WARRANTY, to the extent permitted by law.
.SH AUTHORS
YellowJacket GNU/Linux.
